# 3.1 入金接口
**简要描述：** 

- 请求入金，获取入金的跳转链接

**请求URL：** 
- `/api/recharge/check/v2 `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|p1 |是|double | 入金金额（购买usdt数量） 例：100.0  |
|p2 |是|string |VVPay分配的商户号（UID）,可在VVPayApp->api配置或http://merchant.vvpay.me网站上获取  |
|p3 |是|string | 商户订单号,由商户生成，同一个商户号下唯一  |
|p4 |否|string | 支付方式，可不传（不传时默认CNY）,具体值请参考支付方式列表，传CNY、VND、USD 以外的值时，需要咨询VVPay客服此支付方式是否开通  |
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： p1&p2&p3&timestamp 

- 支付方式列表: CNY/VND/USD/INR/THB/HKD/MYR/EUR/GBP

|参数值|支付方式|
|:----    |:---|
|CNY |	人民币    |
|VND |	越南盾    |
|USD |	美元    |
|INR |	印度卢比    |
|THB |	泰铢    |
|HKD |	港元    |
|MYR |	马来西亚林吉特    |
|EUR |	欧元    |
|GBP |	英镑    |

 **返回参数说明** 

```
{
	"code": 200,
	"data": {
		"url": "http://pay-api.vvpay.me/mobile/buy?orderNo=USDT1609233285404590147&amount=100.0&usdtAmount=100.0&exchangeRate=1.0&merchantName=VVPay+Demo&closeCurrency=CNY"
	},
	"message": "success"
}
```

- 注：获取到url之后，直接重定向到此url即可，只能重定向一次

- 注：商户crm如果想按照自己平台的入金汇率给用户入金，  
    比如商户crm入金汇率为6.6  
    VVPay的入金汇率为6.5（可通过VVPay报价接口查出）  
    用户在crm入金100美金  
    这时候用户需要付的金额就为 100*6.6=660元人民币  
    只需要用 100*6.6/6.5=101.538462 (结果小数点后保留6位有效数字)作为VVPay入金接口的p1(入金usdt数量)传过来，用户付款金额即为660人民币  
    回调的时候，商户crm根据回调时候的订单号，查出用户在crm入的金额为100美金，为用户入100美金  
    最终达到的效果是：  
    1.用户在crm入金100美金  
    2.用户付款660人民币  
    3.商户在VVPay得到101.538462*（1-入金手续费）个USDT  

# 3.2 查询USDT报价    

**简要描述：** 

- 查询报价

**请求URL：** 
- `/api/recharge/convert/v1 `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|p1 |是|string | 商户的商户号(UID)  |
|p2 |否|string |法币类型(不参与加密) 可不传，默认 CNY |
|p3|是|string|入金金额 （法币金额）(不参与加密) 如果p2是CNY p3就是CNY的金额|
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： p1&timestamp

 **返回参数说明** 

```
{
    "code":200,
    "data":{
        "price":6.46 //VVPay平台USDT报价（汇率）,即购买一个usdt对应法币的价格
    },
    "message":"success"
}
```
 **请求示例** 
 ```
 curl -X GET -H "content-type:application/json" -H "access_key:8A42FADDD2397F4841B1F85C2C13094CAB152151" -H "app_id:41043343" http://merchant-api.vvpay.me/api/recharge/convert/v1?timestamp=1609385362&p1=9357&p2=CNY&p3=695
 ```

# 3.3 入金 直接返回订单数据

**简要描述：** 

- 入金 直接返回订单数据，商户需要在自己的crm系统做收银台页面时，可以调用此接口，如果用VVPay提供的收银台，请用3.1入金接口
- 调用此接口入金，用户付款之后，需要调用3.4用户点击已付款 接口，标记订单状态为已付款，否则承兑商无法释放此订单，此订单无法完成
**请求URL：** 
- `/api/recharge/check/v3 `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|p1 |是|string | 入金金额（USDT）  |
|p2 |是|string |商户的商户号(UID) |
|p3|是|string|商户订单号|
|p4|否|string|交易结算法币(不参与加密) 可不传，默认 CNY|
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： p1&p2&p3&timestamp

 **返回参数说明** 

```
}
    "code":200,
    "data":{
        marketPrice":6.91,
        currencyFee":1.0,
        payEffivetTime":10.0,
        remark":"用户入金购买订单",
        invsetPoint":0,
        realCurrencyCount":99.0,
        "floatPoint":0.0086,
        "currency":"USDT",      //购买币种
        "id":50272,
        "state":1,
        "investUserId":490,
        "tradeCloseCurrency":"CNY", //付款法币类型
        "depositOrderNo":"USDT1597136633878653397",
        "investCurrencyCount":100.0,        //购买数量
        "orderNo":"USDT159713663390201",
        "headImg":null,
        "userChannels":[ //收款方式
             {
                "realName":"吴冰涛",
                "depositBank":"支付宝",
                "createTime":1596148869000,
                "nickName":"专业承兑商",
                "cardImgUrl":"/picture/upIb/17729779995_1596148869865_.png",
                "updateTime":1596148869000,
                "id":386,
                "bankAddress":"支付宝",
                "userId":531,
                "cardNumber":"13253663580@163.com",
                "channelId":2
             }],
        "nickName":"专业承兑商",
        "tradeCountMonth":36476.48,
        "currentPrice":6.97,     //单价
        "bidId":594,
        "bidUserId":531,
        "currencyTypeId":1,
        "realName":"吴冰涛",
        "areaId":1,
        "tradeCount":17,
        "createTime":"2020-08-1117:03:53",
        "serial":"390201",  /备注参考号
        "investAmount":697.0,  //交易金额
        "lastEffivectTime":"2020-08-1117:13:53"
    },
    "message":"success"
}
```
# 3.4 用户点击已付款
**简要描述：** 

- 用户点击已付款，调用3.3接口入金时，需要调用此接口确认付款

**请求URL：** 
- `/api/recharge/pay/complete `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|p1|是|string|商户订单号|
|p2|是|string|客户真实姓名（用以核对付款人信息）|
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： p1&p2&p3&p4&timestamp

 **返回参数说明** 

```
{
    "code":200, //成功
    "message":"success" 
}
```
```
{
    "code":500, //失败
    "message":"您已点击过，无需再次点击" 
}
```
# 3.5 入金 集成到自己系统  数字货币入金
**简要描述：** 

- 入金 集成到自己系统  数字货币入金，商户需要在自己的crm系统做收银台页面，并且支付方式只有数字货币时，可调用此接口入金

**请求URL：** 
- `/api/recharge/check/v4 `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|p1 |是|Double | 入金金额（USDT）  |
|p2 |是|string |商户的商户号(UID) |
|p3|是|string|商户订单号|
|p4|是|int|数字货币支付类型:1 USDT  3 ETH|
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： p1&p2&p3&p4&timestamp

 **返回参数说明** 

```
{
    "code":200,
    "data":{
        "usdAmount":11988.6, //折合美金数量
        "address":"1f5s4fdsfd1f23f4ds864f51s2f15sdf4s6f4sf1e2", //钱包地址
        "orderNo":"USDT1556487965324", //VVPay订单号
        "currency":"USDT", //入金币种
        "merchantOrderNo":"PAY1604297618", //商户订单号
        "currencyCount":30  //入金数量
    },
    "message":"success"
}
```
- 注：用户在其他平台（如 火币）往钱包地址（address）里边转入(currencyCount)的（currency）,交易完成，自动回调


# 3.6 商户入金异步通知（回调）
**简要描述：** 

- 商户入金异步通知，需要商户自己开发回调接口，当订单完成时，由VVPay 调用此接口通知商户用户入金结果

**请求URL：** 
- `由商户通过VVPay APP 或者 登录VVPay商户网站（http://merchant.vvpay.me）配置回调地址 `

**请求方式：**
- POST

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|amount|是|Double|入金金额（购买USDT数量）|
|exchangeRate|是|Double|目前固定是 1.0 ，无实际意义|
|poundage|是|Double|手续费|
|merchantNo|是|string|商户的商户号(UID)|
|merchantOrderNo|是|string|商户订单号|
|orderNo|是|string|VVPay交易流水号|
|sign|是|sting|签名|
|timestamp |是|string | 10位时间戳  |
|currency|否|string|入金币种 如:USDT(ERC20)|
|fiatCurrency |否|string | 入金结算的法币类型 例：CNY  |
|fiatRate |否|Double | 入金币种对入金结算法币的汇率 例：6.43  |
|fiatAmount |否|Double | 入金结算法币的金额 例：1000.00  |

- 参数加密顺序：amount&exchangeRate&poundage&merchantNo&merchantOrderNo&orderNo&timestamp
- 通过商户后台配置密钥加密。 商户请严格按照签名规则验证数据，保证数据的安全性和合法性。

**接收返回值格式:**

```
{
    "code":200
}
```
或
```
success
```
- 商户在收到通知后返回{"code":200} 或者 success 字符串 ,否则VVPay 视为商户未成功收到通知，并采用以下重复策略通知策略继续通知：15s-3m-10m-30m-1h-2h-6h-15h
- 如果在通知策略时间内商户仍未返回成功码，VVPay则视为商户服务异常，放弃本笔订单通知，相关订单状态可在商户平台查询
- 异步通知只有在商户订单成功完成后才会触发，因此，异步通知失败不代表支付失败

# 3.7 查询入金订单状态
**简要描述：** 

- 查询入金订单状态

**请求URL：** 
- `/api/recharge/order/query `

**请求方式：**
- GET

**参数(body)：** 

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|merchantNo |是|string | 商户的商户号(UID)  |
|merchantOrderNo |是|string |商户订单号  |
|timestamp |是|string | 10位时间戳  |

- 参数加密顺序： merchantNo&timestamp

 **返回参数说明** 

```
{
    "code":200,
    "data":{
        "amount":"1000.0", //入金金额
        "orderNo":"USDT1600328924378686589", //VVPay 交易流水号
        "poundage":"34.0", //手续费（USDT）
        "sign":"E108F5D8BBD51FE061B568101D83C189C20DCA82",
        "currency":"USDT(ERC20)", //入金币种 例 ：USDT(ERC20)
        "state":"1", //0: 初始化（未支付） 1:入金成功（回调失败） ；2:回调成功
        "merchantOrderNo":"PAY1600328923", //商户订单号
        "merchantNo":"5066",  //商户的商户号
        "timestamp":"1609225317"  //时间戳
        }, 
    "message":"success"
    }

```
- 状态（state） 为 1 时，说明这个订单已经支付成功，但是回调商户的回调地址时出现了错误，或者回调地址没有返回正确的结果，请检查回调地址是否填写错误，是否可以调通，是否返回了正确的结果（{"code:200} 或者  success 字符串）

